"use strict";var App={},$=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document);function AmbientLight(e,t){this.video=e,this.ambient=t,this.light1=t.querySelector(".light-1"),this.light2=t.querySelector(".light-2"),this.interval=-1}!function(){App.goto=function(n,e){var i=$("section.visible"),o=$(".page."+n),a=e?"up":"down";if(!o||"boolean"!=typeof e)throw new Error("Wrong arguments: "+o+", "+e);if(i==o)throw new Error("Moving to the same page..");if(i){var r=i.getAttribute("data-page");App.call(r,"unloading"),i.classList.remove("visible"),i.classList.add("exit-"+a),i.addEventListener("animationend",function e(t){App.call(r,"unloaded"),i.removeEventListener("animationend",e),i.classList.remove("exit-"+a)})}App.call(n,"loading"),o.classList.add("visible"),o.classList.add("enter-"+a),o.addEventListener("animationend",function e(t){App.call(n,"loaded"),o.removeEventListener("animationend",e),o.classList.remove("enter-"+a),"home"!==n&&App.setLocation(n)})};var a=!(App.home=function(){window.location.href?window.location.href=window.location.href.substring(0,window.location.href.indexOf("#")-1):window.location.reload()});App.setLocation=function(e){a=!0,window.location.hash="#/"+e,setTimeout(function(){a=!1},1)},App.gotoHash=function(e){if(!a){if(window.location.hash&&2<window.location.hash.length){var t=window.location.hash.substring(2),n=$(".page."+t);if("home"===t)return void App.home();if(n&&n.classList.contains("page")){var i=$("section.visible");if(i){i.classList.remove("visible");var o=i.getAttribute("data-page");App.call(o,"unloading"),App.call(o,"unloaded")}return n.classList.add("visible"),App.call(t,"loading"),App.call(t,"loaded"),void(window.HYPERSPACE=!1)}}e&&App.home()}};var i={};App.call=function(e,t){if(i[e]&&i[e][t])for(var n=i[e][t].length-1;0<=n;n--)i[e][t][n]()},App.bind=function(e,t,n){i[e]||(i[e]={}),i[e][t]||(i[e][t]=[]),i[e][t].push(n)}}(),window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,function(){for(var a=0,e=["webkit","moz"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var n=(new Date).getTime(),i=Math.max(0,16-(n-a)),o=window.setTimeout(function(){e(n+i)},i);return a=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),AmbientLight.prototype.play=function(){this.ambient.classList.add("active");var n=this;this.interval=setInterval(function(){var e=n.light1.classList.contains("active")?n.light2:n.light1;if(!e.children[0]){var t=document.createElement("canvas");t.getContext("2d");t.width=1,t.height=1,t.classList.add("background"),e.appendChild(t)}e.children[0].getContext("2d").drawImage(n.video,0,0,1,1),n.light1.classList.toggle("active"),n.light2.classList.toggle("active")},1e3)},AmbientLight.prototype.stop=function(){this.ambient.classList.remove("active"),clearInterval(this.interval)},function(){var l=!1,e=$(".episode-1 .drawing canvas"),n=$(".episode-1 .video"),i=new AmbientLight(n,$(".episode-1 .ambient"));if(e&&e.getContext){e.width=window.innerWidth,e.height=window.innerHeight;var o,a,r,s,c,h,p=e.getContext("2d"),u=e.width,g=e.height,d=null,f=!1,m=~~(u/2),v=~~(g/2),w=0,A=-1,b=0,y=Math.PI/2,L=function(e){a.buffer=e,a.start(0),a.loop=!0,f=!0},T=function(e){console.warn(e)};p.strokeStyle="white",p.shadowBlur=100,p.shadowColor="rgb(220, 20, 220)";var x=function(){p.lineWidth=3;var e,t,n=c.length,i=~~(n/30),o=~~(u/30);for(p.beginPath(),p.moveTo(0,v),e=0,t=i;t<n-i;t+=i)e++,p.lineTo(e*o,(150*Math.random()-75)*b+v);p.lineTo(u,v),p.stroke()},C=function(){if(l){E();var e,t,n=0,i=h.length-300,o=~~(i/40),a=~~(m/40);for(p.lineWidth=~~(3+6*Math.random()),p.beginPath(),p.moveTo(0,v),e=0,t=i-o;0<=t;t-=o)e++,n=h[t+5]/256,p.lineTo(e*a,g-v-n*v*Math.sin(y+e/5)*b);for(t=e=0;t<i-2*o;t+=o)e++,n=h[t+5]/256,p.lineTo(m+e*a,g-v-n*v*Math.cos(y+e/5)*b);p.lineTo(u,v),p.stroke();var r=c.length,s=~~(r/30),d=~~(u/30);for(p.lineWidth=~~(2+4*Math.random()),p.beginPath(),p.moveTo(0,v),e=0,t=s;t<r-s;t+=s)e++,n=g-g*c[t]/256-1,p.lineTo(e*d,n);for(p.lineTo(u,v),p.stroke(),p.beginPath(),p.moveTo(0,v),e=0,t=r-s;s<=t;t-=s)e++,n=g-g*c[t]/256-1,p.lineTo(e*d,n);p.lineTo(u,v),p.stroke()}},E=function(){p.clearRect(0,0,u,g)};try{o=new AudioContext}catch(e){console.warn("Web Audio API is not supported in this browser")}App.bind("episode-1","loaded",function(){var e,t;l=!0,a=o.createBufferSource(),r=o.createAnalyser(),s=o.createScriptProcessor(1024,1,1),c=new Uint8Array(r.frequencyBinCount),h=new Uint8Array(r.frequencyBinCount),a.connect(o.destination),a.connect(r),r.connect(s),s.connect(o.destination),n.currentTime=0,n.play(),i.play(),s.addEventListener("audioprocess",function(e){var t=(new Date).getTime();t-30<w||(w=t,b=function(e){for(var t=0,n=e.length,i=0;i<n;i++)t+=e[i];return t/n}(h)/100,r.getByteTimeDomainData(c),r.getByteFrequencyData(h),!0===f&&window.requestAnimationFrame(C))}),null===d?(e="media/episode1.mp3",(t=new XMLHttpRequest).open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){o.decodeAudioData(t.response,function(e){L(d=e)},T)},t.send()):L(d),A=setInterval(x,62)}),App.bind("episode-1","unloading",function(){clearInterval(A),i.stop(),l=!1,a.stop(0),f=!1}),App.bind("episode-1","unloaded",function(){E(),n.currentTime=0,n.pause()})}}(),function(){var s=!1,d=$(".episode-2 .canvas"),e=$(".episode-2 .drawing canvas"),n=$(".episode-2 .video"),i=new AmbientLight(n,$(".episode-2 .ambient"));if(d&&d.getContext){d.width=500,d.height=500,e.width=window.innerWidth,e.height=window.innerHeight;var o,a,r,l,c,h,p,u,g=d.getContext("2d"),f=e.getContext("2d"),t=d.width,m=d.height,v=e.width,w=e.height,A=null,b=!1,y=~~(v/2),L=~~(w/2),T=0,x=[],C=(p=!(h=[]),u=0,{init:function(e){var t=e.count;u=e.width,e.height;for(var n=.106*u>>0,i=document.getElementById("circles"),o=0;o<t;o++){var a=document.createElement("div");a.style.width=a.style.height=o/t*n+"px",a.classList.add("circle"),h.push(a),i.appendChild(a)}p=!0},isInitialized:function(){return p},renderFrame:function(e){for(var t=0,n=0;n<h.length;n++){var i=h[n];i.style.cssText="-webkit-transform:scale("+e[n]/256+")",n<h.length/2?t+=16:t-=16,i.style.backgroundColor="rgba(0,0,"+t+",0.05)"}}}),E=function(e){a.buffer=e,a.start(0),a.loop=!0,b=!0},M=function(e){console.warn(e)},q=function(){var e={x:250,y:250,speed:{}};return e.speed.x=10*Math.random()-5,e.speed.y=10*Math.random()-5,e.style="white",e.radius=1,e},k=function(){if(s){F(),function(){for(var e=0;e<x.length;e++){var t=x[e];(t.x<0||t.x>d.width||t.y<0||t.y>d.height)&&(t=x[e]=q()),t.x+=t.speed.x,t.y+=t.speed.y,g.beginPath(),g.fillStyle=t.style,g.arc(t.x,t.y,t.radius,0,2*Math.PI),g.fill()}}(),C.renderFrame(c);var e,t,n=0;f.strokeStyle="white",f.shadowBlur=100,f.shadowColor="rgb(20, 20, 220)";var i=c.length-300,o=~~(i/40),a=~~(y/40),r=-1;for(f.lineWidth=~~(3+6*Math.random()),f.beginPath(),e=0,t=i-o;0<=t;t-=o)e++,-1<r?(n=c[t+5]/256,f.lineTo(e*a,w-L-n*L)):.1<c[t+5]/256&&(r=t,f.moveTo(e*a,L));for(t=e=0;t<i-2*o-(i-r);t+=o)e++,n=c[t+5]/256,f.lineTo(y+e*a,w-L-n*L);for(f.lineTo(y+e*a+o,L),f.stroke(),f.lineWidth=~~(3+6*Math.random()),f.beginPath(),f.moveTo(0,L),e=0,r=-1,t=i-o;0<=t;t-=o)e++,-1<r?(n=c[t+5]/256,f.lineTo(e*a,w-L+n*L)):.1<c[t+5]/256&&(r=t,f.moveTo(e*a,L));for(t=e=0;t<i-2*o-(i-r);t+=o)e++,n=c[t+5]/256,f.lineTo(y+e*a,w-L+n*L);f.lineTo(y+e*a+o,L),f.stroke()}},F=function(){g.clearRect(0,0,t,m),f.clearRect(0,0,v,w)};try{o=new AudioContext}catch(e){console.warn("Web Audio API is not supported in this browser")}for(var I=0;I<100;I++)x.push(q());App.bind("episode-2","loaded",function(){var e,t;s=!0,a=o.createBufferSource(),r=o.createAnalyser(),l=o.createScriptProcessor(1024,1,1),new Uint8Array(r.frequencyBinCount),c=new Uint8Array(r.frequencyBinCount),a.connect(o.destination),a.connect(r),r.connect(l),l.connect(o.destination),n.currentTime=0,n.play(),i.play(),C.isInitialized()||C.init({count:10,width:360,height:360}),l.addEventListener("audioprocess",function(e){var t=(new Date).getTime();t-30<T||(T=t,r.getByteFrequencyData(c),!0===b&&window.requestAnimationFrame(k))}),null===A?(e="media/episode2.mp3",(t=new XMLHttpRequest).open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){o.decodeAudioData(t.response,function(e){E(A=e)},M)},t.send()):E(A)}),App.bind("episode-2","unloading",function(){i.stop(),s=!1,a.stop(0),b=!1}),App.bind("episode-2","unloaded",function(){F(),n.currentTime=0,n.pause()})}}(),function(){var d=.1,l=!0;App.bind("home","unloading",function(){var e=setInterval(function(){70<(d=1.3*(d+.1))&&clearInterval(e)},100),t=$(".page.home"),n=$(".page.select");t.classList.add("exit-hyperspace"),n.classList.add("enter-hyperspace")}),App.bind("home","unloaded",function(){l=!1;var e=$(".page.home"),t=$(".page.select");e.classList.remove("visible"),e.classList.remove("exit-hyperspace"),t.classList.remove("enter-hyperspace")}),function(e){if(e.width=window.innerWidth,e.height=window.innerHeight,e.getContext){for(var i=e.getContext("2d"),o=e.width,a=e.height,r=[],s=function(){var e=Math.random(),t=Math.random(),n=~~(80*Math.random()+20);return{x:e*o,y:t*a,xs:(e*o-o/2)/500,ys:(t*a-a/2)/500,size:~~(n/20),length:10*Math.random(),color:"rgb("+n+", "+n+", "+~~(n+20*Math.random())+")"}},t=0;t<100;t++)r.push(s());!function e(){if(l){window.requestAnimationFrame(e),i.clearRect(0,0,o,a);for(var t=0;t<100;t++){var n=r[t];(n.x<0||n.y<0||n.x>o||n.y>a)&&(n=r[t]=s()),i.strokeStyle=n.color,i.lineWidth=n.size,i.shadowBlur=5,i.lineCap="round",i.shadowColor="#555",i.beginPath(),i.moveTo(n.x,n.y),i.lineTo(n.x+.1+n.length*n.xs*d,n.y+n.length*n.ys*d),i.stroke(),n.x+=n.xs*d,n.y+=n.ys*d}}}()}}($(".hyperspace"))}(),App.init=function(){!function(e){for(var t=e.length-1;0<=t;t--)(new Image).src=e[t]}(["img/film-1.jpg","img/film-2.jpg","img/film-3.jpg","img/film-4.jpg","img/film-5.jpg","img/film-6.jpg","img/film-7.jpg","img/lock.svg","img/star-wars-logo.svg","img/starship-left.png","img/starship-right.png","img/vote-left.jpg","img/vote-right.jpg"]),window.addEventListener("load",function(){var e=$("section.loader");if(e&&(e.addEventListener("transitionend",function(){e.classList.remove("visible","fade-out")}),e.classList.add("fade-out")),window.location.hash&&2<window.location.hash.length){var t=window.location.hash.substring(2),n=$(".page."+t);if(n&&n.classList.contains("page"))return n.classList.add("visible"),App.call(t,"loading"),void App.call(t,"loaded")}$(".page.home").classList.add("visible"),App.call("home","loading"),App.call("home","loaded")})},function(){$(".begin").addEventListener("click",function(e){App.call("home","unloading"),App.call("select","loading");var n=$(".page.select");n.addEventListener("animationend",function e(t){n.removeEventListener("animationend",e),App.call("home","unloaded"),App.call("select","loaded"),$(".page.select").classList.add("visible"),App.setLocation("select")})});for(var e=$$(".navigation"),t=e.length-1;0<=t;t--)e[t].addEventListener("click",function(e){this.getAttribute("data-target")&&App.goto(this.getAttribute("data-target"),"up"===this.getAttribute("data-direction")),e.preventDefault()});window.addEventListener("hashchange",App.gotoHash)}(),function(){var i={lastMove:0,leftOffset:window.screen.width/2-100,rightOffset:0,screenScale:100-100/1.75,selectCards:$(".select .cards")};i.percentDivisor=window.screen.width-i.rightOffset-i.leftOffset;var e=function(e){var t=(new Date).getTime();if(i.lastMove<t-20){i.lastMove=t;var n=(e.screenX-i.leftOffset)/i.percentDivisor;n<0?n=0:1<n&&(n=1),i.selectCards.style.transform="translateZ(0) translateX(-"+n*i.screenScale+"%)"}};App.bind("select","loading",function(){document.addEventListener("mousemove",e)}),App.bind("select","unloading",function(){document.removeEventListener("mousemove",e)})}(),function(){for(var i=$$(".button-vote"),e=function(n){n.addEventListener("click",function(e){for(var t=i.length-1;0<=t;t--)i[t].innerHTML="VOTE";n.innerHTML="I Voted !"})},t=i.length-1;0<=t;t--)e(i[t])}(),App.init();
//# sourceMappingURL=script.js.map
